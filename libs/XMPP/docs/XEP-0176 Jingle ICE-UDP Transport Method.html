<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<!-- saved from url=(0040)http://xmpp.org/extensions/xep-0176.html -->
<HTML xmlns="http://www.w3.org/1999/xhtml"><HEAD><TITLE>XEP-0176: Jingle ICE-UDP Transport Method</TITLE>
<META content="text/html; charset=UTF-8" http-equiv=Content-Type><LINK 
rel=stylesheet type=text/css 
href="XEP-0176%20Jingle%20ICE-UDP%20Transport%20Method_files/xmpp.css"><LINK 
rel=stylesheet type=text/css 
href="XEP-0176%20Jingle%20ICE-UDP%20Transport%20Method_files/prettify.css"><LINK 
rel="shortcut icon" type=image/x-icon href="/favicon.ico">
<SCRIPT type=text/javascript 
src="XEP-0176%20Jingle%20ICE-UDP%20Transport%20Method_files/prettify.js"></SCRIPT>

<META name=DC.Title content="Jingle ICE-UDP Transport Method">
<META name=DC.Creator content="Joe Beda">
<META name=DC.Creator content="Scott Ludwig">
<META name=DC.Creator content="Peter Saint-Andre">
<META name=DC.Creator content="Joe Hildebrand">
<META name=DC.Creator content="Sean Egan">
<META name=DC.Creator content="Robert McQueen">
<META name=DC.Description 
content="This specification defines a Jingle transport method that results in sending media data using raw datagram associations via the User Datagram Protocol (UDP). This transport method is negotiated via the Interactive Connectivity Establishment (ICE) methodology, which provides robust NAT traversal for media traffic.">
<META name=DC.Publisher content="XMPP Standards Foundation">
<META name=DC.Contributor content="XMPP Extensions Editor">
<META name=DC.Date content=2009-06-10>
<META name=DC.Type content="XMPP Extension Protocol">
<META name=DC.Format content=XHTML>
<META name=DC.Identifier content=XEP-0176>
<META name=DC.Language content=en>
<META name=DC.Rights 
content="This XMPP Extension Protocol is copyright © 1999 - 2010 by the XMPP Standards Foundation (XSF).">
<META name=GENERATOR content="MSHTML 8.00.7600.16385"></HEAD>
<BODY onload=prettyPrint()>
<H1>XEP-0176: Jingle ICE-UDP Transport Method</H1>
<TABLE>
  <TBODY>
  <TR vAlign=top>
    <TD><STRONG>Abstract:</STRONG></TD>
    <TD>This specification defines a Jingle transport method that results in 
      sending media data using raw datagram associations via the User Datagram 
      Protocol (UDP). This transport method is negotiated via the Interactive 
      Connectivity Establishment (ICE) methodology, which provides robust NAT 
      traversal for media traffic.</TD></TR>
  <TR vAlign=top>
    <TD><STRONG>Authors:</STRONG></TD>
    <TD>Joe Beda, Scott Ludwig, Peter Saint-Andre, Joe Hildebrand, Sean Egan, 
      Robert McQueen</TD></TR>
  <TR vAlign=top>
    <TD><STRONG>Copyright:</STRONG></TD>
    <TD>© 1999 - 2010 XMPP Standards Foundation. <A 
      href="http://xmpp.org/extensions/xep-0176.html#appendix-legal">SEE LEGAL 
      NOTICES</A>.</TD></TR>
  <TR vAlign=top>
    <TD><STRONG>Status:</STRONG></TD>
    <TD>Draft</TD></TR>
  <TR vAlign=top>
    <TD><STRONG>Type:</STRONG></TD>
    <TD>Standards Track</TD></TR>
  <TR vAlign=top>
    <TD><STRONG>Version:</STRONG></TD>
    <TD>1.0</TD></TR>
  <TR vAlign=top>
    <TD><STRONG>Last&nbsp;Updated:</STRONG></TD>
    <TD>2009-06-10</TD></TR></TBODY></TABLE>
<HR>

<P style="COLOR: green">NOTICE: The protocol defined herein is a <STRONG>Draft 
Standard</STRONG> of the XMPP Standards Foundation. Implementations are 
encouraged and the protocol is appropriate for deployment in production systems, 
but some changes to the protocol are possible before it becomes a Final 
Standard.</P>
<HR>

<H2>Table of Contents</H2>
<DIV class=indent>
<P><BR>1. <A 
href="http://xmpp.org/extensions/xep-0176.html#intro">Introduction</A><BR>2. <A 
href="http://xmpp.org/extensions/xep-0176.html#terms">Glossary</A><BR>3. <A 
href="http://xmpp.org/extensions/xep-0176.html#reqs">Requirements</A><BR>4. <A 
href="http://xmpp.org/extensions/xep-0176.html#conformance">Jingle 
Conformance</A><BR>5. <A 
href="http://xmpp.org/extensions/xep-0176.html#protocol">Protocol 
Description</A><BR>&nbsp;&nbsp;&nbsp; 5.1. <A 
href="http://xmpp.org/extensions/xep-0176.html#protocol-flow">Overall 
Flow</A><BR>&nbsp;&nbsp;&nbsp; 5.2. <A 
href="http://xmpp.org/extensions/xep-0176.html#protocol-initiate">Session 
Initiation</A><BR>&nbsp;&nbsp;&nbsp; 5.3. <A 
href="http://xmpp.org/extensions/xep-0176.html#protocol-syntax">Syntax</A><BR>&nbsp;&nbsp;&nbsp; 
5.4. <A 
href="http://xmpp.org/extensions/xep-0176.html#protocol-response">Response</A><BR>&nbsp;&nbsp;&nbsp; 
5.5. <A 
href="http://xmpp.org/extensions/xep-0176.html#protocol-candidates">Candidate 
Negotiation</A><BR>&nbsp;&nbsp;&nbsp; 5.6. <A 
href="http://xmpp.org/extensions/xep-0176.html#protocol-checks">Connectivity 
Checks</A><BR>&nbsp;&nbsp;&nbsp; 5.7. <A 
href="http://xmpp.org/extensions/xep-0176.html#protocol-acceptance">Acceptance 
of Successful Candidate</A><BR>&nbsp;&nbsp;&nbsp; 5.8. <A 
href="http://xmpp.org/extensions/xep-0176.html#protocol-renegotiate">Negotiating 
a New Candidate</A><BR>&nbsp;&nbsp;&nbsp; 5.9. <A 
href="http://xmpp.org/extensions/xep-0176.html#protocol-restarts">ICE 
Restarts</A><BR>6. <A 
href="http://xmpp.org/extensions/xep-0176.html#fallback">Fallback to Raw 
UDP</A><BR>7. <A 
href="http://xmpp.org/extensions/xep-0176.html#support">Determining 
Support</A><BR>&nbsp;&nbsp;&nbsp; 7.1. <A 
href="http://xmpp.org/extensions/xep-0176.html#support-ice">ICE 
Support</A><BR>&nbsp;&nbsp;&nbsp; 7.2. <A 
href="http://xmpp.org/extensions/xep-0176.html#support-sdp">SDP Offer / Answer 
Support</A><BR>8. <A 
href="http://xmpp.org/extensions/xep-0176.html#impl">Implementation 
Notes</A><BR>9. <A 
href="http://xmpp.org/extensions/xep-0176.html#deploy">Deployment 
Notes</A><BR>10. <A 
href="http://xmpp.org/extensions/xep-0176.html#security">Security 
Considerations</A><BR>&nbsp;&nbsp;&nbsp; 10.1. <A 
href="http://xmpp.org/extensions/xep-0176.html#security-sharing">Sharing IP 
Addresses</A><BR>&nbsp;&nbsp;&nbsp; 10.2. <A 
href="http://xmpp.org/extensions/xep-0176.html#security-media">Encryption of 
Media</A><BR>11. <A href="http://xmpp.org/extensions/xep-0176.html#iana">IANA 
Considerations</A><BR>12. <A 
href="http://xmpp.org/extensions/xep-0176.html#registrar">XMPP Registrar 
Considerations</A><BR>&nbsp;&nbsp;&nbsp; 12.1. <A 
href="http://xmpp.org/extensions/xep-0176.html#registrar-ns">Protocol 
Namespaces</A><BR>&nbsp;&nbsp;&nbsp; 12.2. <A 
href="http://xmpp.org/extensions/xep-0176.html#registrar-versioning">Protocol 
Versioning</A><BR>&nbsp;&nbsp;&nbsp; 12.3. <A 
href="http://xmpp.org/extensions/xep-0176.html#registrar-features">Service 
Discovery Features</A><BR>&nbsp;&nbsp;&nbsp; 12.4. <A 
href="http://xmpp.org/extensions/xep-0176.html#registrar-transports">Jingle 
Transport Methods</A><BR>13. <A 
href="http://xmpp.org/extensions/xep-0176.html#schema">XML Schema</A><BR>14. <A 
href="http://xmpp.org/extensions/xep-0176.html#ack">Acknowledgements</A></P>
<P><A 
href="http://xmpp.org/extensions/xep-0176.html#appendices">Appendices</A><BR>&nbsp;&nbsp;&nbsp;&nbsp;<A 
href="http://xmpp.org/extensions/xep-0176.html#appendix-docinfo">A: Document 
Information</A><BR>&nbsp;&nbsp;&nbsp;&nbsp;<A 
href="http://xmpp.org/extensions/xep-0176.html#appendix-authorinfo">B: Author 
Information</A><BR>&nbsp;&nbsp;&nbsp;&nbsp;<A 
href="http://xmpp.org/extensions/xep-0176.html#appendix-legal">C: Legal 
Notices</A><BR>&nbsp;&nbsp;&nbsp;&nbsp;<A 
href="http://xmpp.org/extensions/xep-0176.html#appendix-xmpp">D: Relation to 
XMPP</A><BR>&nbsp;&nbsp;&nbsp;&nbsp;<A 
href="http://xmpp.org/extensions/xep-0176.html#appendix-discuss">E: Discussion 
Venue</A><BR>&nbsp;&nbsp;&nbsp;&nbsp;<A 
href="http://xmpp.org/extensions/xep-0176.html#appendix-conformance">F: 
Requirements Conformance</A><BR>&nbsp;&nbsp;&nbsp;&nbsp;<A 
href="http://xmpp.org/extensions/xep-0176.html#appendix-notes">G: 
Notes</A><BR>&nbsp;&nbsp;&nbsp;&nbsp;<A 
href="http://xmpp.org/extensions/xep-0176.html#appendix-revs">H: Revision 
History</A></P></DIV>
<HR>

<H2>1. <A id=intro name=intro>Introduction</A></H2>
<P><SPAN class=ref><A 
href="http://xmpp.org/extensions/xep-0166.html">Jingle</A></SPAN> [<A 
href="http://xmpp.org/extensions/xep-0176.html#nt-id119797">1</A>] defines a 
framework for negotiating and managing out-of-band data sessions over XMPP. In 
order to provide a flexible framework, the base Jingle specification defines 
neither data transport methods nor application formats, leaving that up to 
separate specifications.</P>
<P>The current document defines a transport method for establishing and managing 
data exchanges between XMPP entities over the User Datagram Protocol (see <SPAN 
class=ref><A href="http://tools.ietf.org/html/rfc0768">RFC 768</A></SPAN> [<A 
href="http://xmpp.org/extensions/xep-0176.html#nt-id119825">2</A>]), using the 
ICE methodology developed within the IETF and specified in <SPAN class=ref><A 
href="http://tools.ietf.org/html/draft-ietf-mmusic-ice">Interactive Connectivity 
Establishment (ICE)</A></SPAN> [<A 
href="http://xmpp.org/extensions/xep-0176.html#nt-id119848">3</A>] (hereafter 
referred to as <SPAN class=ref>ICE-CORE</SPAN>). Use of this "ice-udp" method 
results in a datagram transport suitable for media applications where some 
packet loss is tolerable (e.g., audio and video).</P>
<P>Note: <SPAN class=ref>ICE-CORE</SPAN> has been approved for publication as an 
RFC but has not yet been published as an RFC. While every effort has been made 
to keep this document synchronized with <SPAN class=ref>ICE-CORE</SPAN>, the 
interested reader is referred to <SPAN class=ref>ICE-CORE</SPAN> for a detailed 
description of the ICE methodology.</P>
<P>The process for ICE negotiation is largely the same in Jingle as it is in 
ICE. There are several differences:</P>
<UL>
  <LI>Instead of using the Session Initiation Protocol (SIP) as the signalling 
  channel, Jingle uses XMPP as the signalling channel.</LI>
  <LI>Syntax from the Session Description Protocol (see <SPAN class=ref><A 
  href="http://tools.ietf.org/html/rfc4566">RFC 4566</A></SPAN> [<A 
  href="http://xmpp.org/extensions/xep-0176.html#nt-id119889">4</A>]) is mapped 
  to an XML syntax suitable for sending over the XMPP signalling channel.</LI>
  <LI>In Jingle, lists of "preferred" candidates are typically sent in the 
  Jingle session-initiate and session-accept messages, in a way that is 
  consistent with the SDP offer / answer model described in <SPAN class=ref><A 
  href="http://tools.ietf.org/html/rfc3264">RFC 3264</A></SPAN> [<A 
  href="http://xmpp.org/extensions/xep-0176.html#nt-id119930">5</A>] and the 
  process described in <SPAN class=ref>ICE-CORE</SPAN>.</LI>
  <LI>Candidates can also be sent in separate transport-info messages either 
  before sending the session-accept message (to expedite negotiation) or after 
  media begins to flow (to find modify existing candidates, find superior 
  candidates, or adjust to changing network conditions).</LI></UL>
<H2>2. <A id=terms name=terms>Glossary</A></H2>
<P>The reader is referred to <SPAN class=ref>ICE-CORE</SPAN> for a description 
of various terms used in the context of ICE. Those terms are not reproduced 
here.</P>
<H2>3. <A id=reqs name=reqs>Requirements</A></H2>
<P>The Jingle transport method defined herein is designed to meet the following 
requirements:</P>
<OL>
  <LI>Make it possible to establish and manage out-of-band connections between 
  two XMPP entities, even if they are behind Network Address Translators (NATs) 
  or firewalls.</LI>
  <LI>Enable use of UDP as the transport protocol.</LI>
  <LI>Make it relatively easy to implement support in standard Jabber/XMPP 
  clients.</LI>
  <LI>Where communication with non-XMPP entities is needed, push as much 
  complexity as possible onto server-side gateways between the XMPP network and 
  the non-XMPP network.</LI></OL>
<H2>4. <A id=conformance name=conformance>Jingle Conformance</A></H2>
<P>In accordance with Section 10 of <SPAN class=ref>XEP-0166</SPAN>, this 
document specifies the following information related to the Jingle ice-udp 
transport method:</P>
<OL>
  <LI>
  <P>The transport negotiation process is defined in the <A 
  href="http://xmpp.org/extensions/xep-0176.html#protocol">Protocol 
  Description</A> section of this document.</P></LI>
  <LI>
  <P>The semantics of the &lt;transport/&gt; element are defined in the <A 
  href="http://xmpp.org/extensions/xep-0176.html#protocol-negotiate">ICE 
  Negotiation</A> section of this document.</P></LI>
  <LI>
  <P>Successful negotiation of the ice-udp method results in use of a datagram 
  transport that is suitable for applications where some packet loss is 
  tolerable, such as audio and video.</P></LI>
  <LI>
  <P>If multiple components are to be communicated by the application type that 
  uses the transport, the transport shall support those components and assign 
  identifiers for them as described in the specification that defines the 
  application type.</P></LI></OL>
<H2>5. <A id=protocol name=protocol>Protocol Description</A></H2>
<DIV class=indent>
<H3>5.1 <A id=protocol-flow name=protocol-flow>Overall Flow</A></H3>
<P>The overall protocol flow for negotiation of the Jingle ICE-UDP Transport 
Method is as follows (note: many of these events happen simultaneously, not in 
sequence).</P>
<P class=caption></P>
<DIV class=indent><PRE class=prettyprint>INITIATOR                              RESPONDER
    |                                      |
    |  Jingle session-initiate stanza      |
    |  (with one or more candidates)       |
    |-------------------------------------&gt;|
    |  Jingle ack (XMPP IQ-result)         |
    |&lt;-------------------------------------|
    |  Jingle session-accept stanza        |
    |  (with one or more candidates)       |
    |&lt;-------------------------------------|
    |  Jingle ack (XMPP IQ-result)         |
    |-------------------------------------&gt;|
    |  multiple STUN Binding Requests      |
    |&lt;====================================&gt;|
    |  multiple STUN Binding Results       |
    |&lt;====================================&gt;|
    |&lt;=========MEDIA NOW FLOWS============&gt;|
    |  optional Jingle transport-info      |
    |  stanzas (one candidate per stanaza) |
    |&lt;------------------------------------&gt;|
    |                                      |
    </PRE></DIV>
<P>Note: The examples in this document follow the scenario described in Section 
17 of <SPAN class=ref>ICE-CORE</SPAN>, except that we substitute the 
Shakespearean characters "Romeo" and "Juliet" for the generic entities "L" and 
"R".</P></DIV>
<DIV class=indent>
<H3>5.2 <A id=protocol-initiate name=protocol-initiate>Session 
Initiation</A></H3>
<P>In order for the initiator in a Jingle exchange to start the negotiation, it 
sends a Jingle "session-initiate" stanza that includes at least one content 
type, as described in <SPAN class=ref>XEP-0166</SPAN>. If the initiator wishes 
to negotiate the ice-udp transport method for an application format, it MUST 
include a &lt;transport/&gt; child element qualified by the 
'urn:xmpp:jingle:transports:ice-udp:1' namespace (see <A 
href="http://xmpp.org/extensions/xep-0176.html#registrar-versioning">Namespace 
Versioning</A> regarding the possibility of incrementing the version number). 
This element SHOULD in turn contain one &lt;candidate/&gt; element for each of 
the initiator's higher-priority transport candidates as determined in accordance 
with the ICE methodology, but MAY instead be empty (with each candidate to be 
sent as the payload of a transport-info message).</P>
<P class=caption><A id=example-1 name=example-1></A>Example 1. Initiation</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='romeo@montague.lit/orchard'
    id='ixt174g9'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='session-initiate'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;description xmlns='urn:xmpp:jingle:apps:rtp:1' media='audio'&gt;
        &lt;payload-type id='96' name='speex' clockrate='16000'/&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
        &lt;payload-type id='0' name='PCMU' /&gt;
        &lt;payload-type id='103' name='L16' clockrate='16000' channels='2'/&gt;
        &lt;payload-type id='98' name='x-ISAC' clockrate='8000'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:1'
                 pwd='asd88fgpdd777uzjYhagZg'
                 ufrag='8hhy'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0'
                   id='el0747fg11'
                   ip='10.0.1.1'
                   network='1'
                   port='8998'
                   priority='2130706431'
                   protocol='udp'
                   type='host'/&gt;
        &lt;candidate component='1'
                   foundation='2'
                   generation='0'
                   id='y3s2b30v3r'
                   ip='192.0.2.3'
                   network='1'
                   port='45664'
                   priority='1694498815'
                   protocol='udp'
                   rel-addr='10.0.1.1'
                   rel-port='8998'
                   type='srflx'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </PRE></DIV></DIV>
<DIV class=indent>
<H3>5.3 <A id=protocol-syntax name=protocol-syntax>Syntax</A></H3>
<P>The &lt;transport/&gt; element's 'pwd' and 'ufrag' attributes MUST be 
included whenever sending one or more candidates to the other party, e.g. in a 
session-initiate, session-accept, transport-info, content-add, or 
transport-replace message. The values for these attributes are separately 
generated for both the initiator and the responder, in accordance with <SPAN 
class=ref>ICE-CORE</SPAN> and as shown in the examples. The attributes of the 
&lt;transport/&gt; element are as follows.</P>
<DIV class=indent>
<P class=caption><A id=table-1 name=table-1></A>Table 1: Transport 
Attributes</P>
<TABLE border=1 cellSpacing=0 cellPadding=3>
  <TBODY>
  <TR class=body>
    <TH>Name</TH>
    <TH>Description</TH>
    <TH>SDP Syntax</TH>
    <TH>Example</TH></TR>
  <TR class=body>
    <TD>pwd</TD>
    <TD>A Password as defined in <SPAN class=ref>ICE-CORE</SPAN>.</TD>
    <TD>a=ice-pwd line</TD>
    <TD>asd88fgpdd777uzjYhagZg</TD></TR>
  <TR class=body>
    <TD>ufrag</TD>
    <TD>A User Fragment as defined in <SPAN class=ref>ICE-CORE</SPAN>.</TD>
    <TD>a=ice-ufrag line</TD>
    <TD>8hhy</TD></TR></TBODY></TABLE></DIV>
<P>The attributes of the &lt;candidate/&gt; element are as follows.</P>
<DIV class=indent>
<P class=caption><A id=table-2 name=table-2></A>Table 2: Candidate 
Attributes</P>
<TABLE border=1 cellSpacing=0 cellPadding=3>
  <TBODY>
  <TR class=body>
    <TH>Name</TH>
    <TH>Description</TH>
    <TH>SDP Syntax</TH>
    <TH>Example</TH></TR>
  <TR class=body>
    <TD>component</TD>
    <TD>A Component ID as defined in <SPAN class=ref>ICE-CORE</SPAN>.</TD>
    <TD>Component ID value in a=candidate line</TD>
    <TD>1</TD></TR>
  <TR class=body>
    <TD>foundation</TD>
    <TD>A Foundation as defined in <SPAN class=ref>ICE-CORE</SPAN>.</TD>
    <TD>Foundation value in a=candidate line</TD>
    <TD>1</TD></TR>
  <TR class=body>
    <TD>generation</TD>
    <TD>An index, starting at 0, that enables the parties to keep track of 
      updates to the candidate throughout the life of the session. For details, 
      see the <A 
      href="http://xmpp.org/extensions/xep-0176.html#protocol-restart">ICE 
      Restarts</A> section of this document.</TD>
    <TD>N/A</TD>
    <TD>0</TD></TR>
  <TR class=body>
    <TD>id</TD>
    <TD>A unique identifier for the candidate.</TD>
    <TD>N/A</TD>
    <TD>el0747fg11</TD></TR>
  <TR class=body>
    <TD>ip</TD>
    <TD>The Internet Protocol (IP) address for the candidate transport 
      mechanism; this can be either an IPv4 address or an IPv6 address.</TD>
    <TD>IP Address value in a=candidate line</TD>
    <TD>192.0.2.3</TD></TR>
  <TR class=body>
    <TD>network</TD>
    <TD>An index, starting at 0, referencing which network this candidate is 
      on for a given peer (used for diagnostic purposes if the calling hardware 
      has more than one Network Interface Card).</TD>
    <TD>N/A</TD>
    <TD>0</TD></TR>
  <TR class=body>
    <TD>port</TD>
    <TD>The port at the candidate IP address.</TD>
    <TD>Port value in a=candidate line</TD>
    <TD>45664</TD></TR>
  <TR class=body>
    <TD>priority</TD>
    <TD>A Priority as defined in <SPAN class=ref>ICE-CORE</SPAN>. [<A 
      href="http://xmpp.org/extensions/xep-0176.html#nt-id120435">6</A>] </TD>
    <TD>Priority value in a=candidate line</TD>
    <TD>2130706431</TD></TR>
  <TR class=body>
    <TD>protocol</TD>
    <TD>The protocol to be used. The only value defined by this specification 
      is "udp". [<A 
      href="http://xmpp.org/extensions/xep-0176.html#nt-id120460">7</A>]</TD>
    <TD>Transport protocol field in a=candidate line</TD>
    <TD>udp</TD></TR>
  <TR class=body>
    <TD>rel-addr</TD>
    <TD>A related address as defined in <SPAN class=ref>ICE-CORE</SPAN>.</TD>
    <TD>raddr value in a=candidate line</TD>
    <TD>10.0.1.1</TD></TR>
  <TR class=body>
    <TD>rel-port</TD>
    <TD>A related port as defined in <SPAN class=ref>ICE-CORE</SPAN>.</TD>
    <TD>rport value in a=candidate line</TD>
    <TD>8998</TD></TR>
  <TR class=body>
    <TD>type</TD>
    <TD>A Candidate Type as defined in <SPAN class=ref>ICE-CORE</SPAN>. The 
      allowable values are "host" for host candidates, "prflx" for peer 
      reflexive candidates, "relay" for relayed candidates, and "srflx" for 
      server reflexive candidates.</TD>
    <TD>Typ field in a=candidate line</TD>
    <TD>srflx</TD></TR></TBODY></TABLE></DIV></DIV>
<DIV class=indent>
<H3>5.4 <A id=protocol-response name=protocol-response>Response</A></H3>
<P>As described in <SPAN class=ref>XEP-0166</SPAN>, to acknowledge receipt of 
the session initiation request, the responder immediately returns an 
IQ-result.</P>
<P class=caption><A id=example-2 name=example-2></A>Example 2. Responder 
acknowledges receipt of session-initiate request</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='juliet@capulet.lit/balcony'
    id='ixt174g9'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
    </PRE></DIV>
<P>Depending on the application type, a user agent controlled by a human user 
might need to wait for the user to affirm a desire to proceed with the session 
before continuing. When the user agent has received such affirmation (or if the 
user agent can automatically proceed for any reason, e.g. because no human 
intervention is expected or because a human user has configured the user agent 
to automatically accept sessions with a given entity), it returns a Jingle 
session-accept message. This message MUST contain a &lt;transport/&gt; element 
qualified by the 'urn:xmpp:jingle:transports:ice-udp:1' namespace, which SHOULD 
in turn contain one &lt;candidate/&gt; element for each ICE-UDP candidate 
generated by or known to the responder, but MAY instead be empty (with each 
candidate to be sent as the payload of a transport-info message).</P>
<P>Note: See the <A 
href="http://xmpp.org/extensions/xep-0176.html#security">Security 
Considerations</A> section of this document regarding the exposure of IP 
addresses by the responder's client.</P>
<P class=caption><A id=example-3 name=example-3></A>Example 3. Responder accepts 
the session request</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='juliet@capulet.lit/balcony'
    id='rw782g55'
    to='romeo@montague.lit/orchard'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='session-accept'
          initiator='romeo@montague.lit/orchard'
          responder='juliet@capulet.lit/balcony'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;description xmlns='urn:xmpp:jingle:apps:rtp:1' media='audio'&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:1'
                 pwd='YH75Fviy6338Vbrhrlp8Yh'
                 ufrag='9uB6'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0'
                   id='or2ii2syr1'
                   ip='192.0.2.1'
                   network='0'
                   port='3478'
                   priority='2130706431'
                   protocol='udp'
                   type='host'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </PRE></DIV></DIV>
<DIV class=indent>
<H3>5.5 <A id=protocol-candidates name=protocol-candidates>Candidate 
Negotiation</A></H3>
<P>The initiator and responder negotiate connectivity over ICE by exchanging 
XML-formatted transport candidates for the channel. This negotiation proceeds 
immediately in order to maximize the possibility that connectivity can be 
established (and therefore media can be exchanged) as quickly as possible. In 
order to expedite session establishment, the initiator SHOULD include transport 
candidates in its session-initiate message but MAY also send additional 
transport candidates as soon as it learns of them, even before receiving 
acknowledgement of the session-initiate message (i.e., the initiator MUST 
consider the session to be live as soon as it sends the session-initiate 
message). [<A 
href="http://xmpp.org/extensions/xep-0176.html#nt-id120586">8</A>]</P>
<P>The first step in negotiating connectivity is for each party to send 
transport candidates to the other party. [<A 
href="http://xmpp.org/extensions/xep-0176.html#nt-id120619">10</A>] These 
candidates SHOULD be gathered by following the procedure specified in Section 
4.1.1 of <SPAN class=ref>ICE-CORE</SPAN> (typically by communicating with a 
standalone STUN server in order to discover the client's public IP address and 
port) and prioritized by following the procedure specified in Section 4.1.2 of 
<SPAN class=ref>ICE-CORE</SPAN>.</P>
<P>Each candidate shall be sent as a &lt;candidate/&gt; child of a 
&lt;transport/&gt; element qualified by the 
'urn:xmpp:jingle:transports:ice-udp:1' namespace. The &lt;transport/&gt; element 
is sent via a Jingle message of type session-initiate, session-accept, or 
transport-info.</P>
<P>Either party MAY include multiple &lt;candidate/&gt; elements in one 
&lt;transport/&gt; element, especially in the session-initiate and 
session-accept messages sent at the beginning of the session negotiation. 
Including multiple candidates in the session-initiate and session-accept 
messages can help to ensure interoperability with entities that implement the 
SDP offer/answer model described in <SPAN class=ref>RFC 3264</SPAN>; in 
particular, an entity SHOULD include multiple candidates in its session-initiate 
or session-accept message if the other party advertises support for the 
"urn:ietf:rfc:3264" service discovery feature as described in the <A 
href="http://xmpp.org/extensions/xep-0176.html#support-sdp">SDP Offer / Answer 
Support</A> section of this document. However, including one candidate per 
subsequent transport-info message typically results in a faster negotiation 
because the candidates most likely to succeed are sent first (in the 
session-info and session-accept messages) and it is not necessary to gather all 
candidates before beginning to send any candidates; furthermore, because certain 
candidates can be more "expensive" in terms of bandwidth or processing power, 
either party might not want to advertise the existence of such candidates unless 
it is necessary to do so after other candidates have failed.</P>
<P>If the party that receives a candidate in a Jingle message can successfully 
process a given candidate or set of candidates, it returns an IQ-result (if not, 
for example because the candidate data is improperly formatted, it returns an 
IQ-error). At this point, the receiving entity is only indicating receipt of the 
candidate or set of candidates, not telling the other party that the candidate 
will be used.</P>
<P>The initiator can keep sending candidates (without stopping to receive an 
acknowledgement of receipt from the responder for each candidate) until it has 
exhausted its supply of possible or desirable transport candidates. The 
responder can also keep sending potential candidates, which the initiator will 
acknowledge.</P></DIV>
<DIV class=indent>
<H3>5.6 <A id=protocol-checks name=protocol-checks>Connectivity Checks</A></H3>
<P>As the initiator and responder receive candidates, they probe the candidates 
for connectivity. In performing these connectivity checks, each party SHOULD 
follow the procedure specified in Section 7 of <SPAN class=ref>ICE-CORE</SPAN>. 
The following business rules apply:</P>
<OL>
  <LI>Each party sends a STUN Binding Request (see <SPAN class=ref><A 
  href="http://tools.ietf.org/html/rfc5389">RFC 5389</A></SPAN> [<A 
  href="http://xmpp.org/extensions/xep-0176.html#nt-id120735">11</A>]) from each 
  local candidate it generated to each remote candidate it received.</LI>
  <LI>In accordance with <SPAN class=ref>ICE-CORE</SPAN>, the STUN Binding 
  Requests MUST include the PRIORITY attribute (computed according to Section 
  7.1.1.1. of <SPAN class=ref>ICE-CORE</SPAN>).</LI>
  <LI>For the purposes of the Jingle ICE-UDP Transport Method, both parties are 
  full ICE implementations and therefore the controlling role MUST be assumed by 
  the initiator and the controlled role MUST be assumed by the responder.</LI>
  <LI>The STUN Binding Requests generated by the initiator MAY include the 
  USE-CANDIDATE attribute to indicate that the initiator wishes to cease checks 
  for this component.</LI>
  <LI>The STUN Binding Requests generated by the initiator MUST include the 
  ICE-CONTROLLING attribute.</LI>
  <LI>The STUN Binding Requests generated by the responder MUST include the 
  ICE-CONTROLLED attribute.</LI>
  <LI>The parties MUST use STUN short term credentials to authenticate requests 
  and perform message integrity checks. As in <SPAN class=ref>ICE-CORE</SPAN>, 
  the username in the STUN Binding Request is of the form 
  "ufrag-of-peer:ufrag-of-sender" and the password is the value of the 'pwd' 
  attribute provided by the peer. [<A 
  href="http://xmpp.org/extensions/xep-0176.html#nt-id120773">12</A>]</LI></OL>
<P>When it receives a STUN Binding Request, each party MUST return a STUN 
Binding Response, which indicates either an error case or the success case. As 
described in Section 7.1.2.2 of <SPAN class=ref>ICE-CORE</SPAN>, a connectivity 
check succeeds if <SPAN class=em>all</SPAN> of the following are true:</P>
<OL>
  <LI>The STUN transaction generated a success response.</LI>
  <LI>The source IP address and port of the response equals the destination IP 
  address and port to which the Binding Request was sent.</LI>
  <LI>The destination IP address and port of the response match the source IP 
  address and port from which the Binding Request was sent.</LI></OL>
<P>For the candidates exchanged in the previous section, the connectivity checks 
would be as follows (this diagram mirrors the example in <SPAN 
class=ref>ICE-CORE</SPAN>).</P>
<P class=caption></P>
<DIV class=indent><PRE class=prettyprint>INITIATOR                  NAT                  RESPONDER
    |                       |                       |
    |                       | STUN Binding Request  |
    |                       | from 192.0.2.1:3478   |
    |                       | to   10.0.1.1:8998    |
    |                       |   (dropped)           |
    |                       |  x====================|
    | STUN Binding Request  |                       |
    | from 10.0.1.1:8998    |                       |
    | to   192.0.2.1:3478   |                       |
    | USE-CANDIDATE         |                       |
    |======================&gt;|                       |
    |                       | STUN Binding Request  |
    |                       | from 192.0.2.3:45664  |
    |                       | to   192.0.2.1:3478   |
    |                       | USE-CANDIDATE         |
    |                       |======================&gt;|
    |                       | STUN Binding Response |
    |                       | from 192.0.2.1:3478   |
    |                       | to   192.0.2.3:45664  |
    |                       |&lt;======================|
    | STUN Binding Response |                       |
    | from 192.0.2.1:3478   |                       |
    | to   10.0.1.1:8998    |                       |
    | map  192.0.2.3:45664  |                       |
    |&lt;======================|                       |
    |                       |                       |
    |&lt;==Media Now Can Flow==|                       |
    |                       |                       |
    |                       | STUN Binding Request  |
    |                       | from 192.0.2.1:3478   |
    |                       | to   192.0.2.3:45664  |
    |                       |&lt;======================|
    | STUN Binding Request  |                       |
    | from 192.0.2.1:3478   |                       |
    | to   10.0.1.1:8998    |                       |
    |&lt;======================|                       |
    | STUN Binding Response |                       |
    | from 10.0.1.1:8998    |                       |
    | to   192.0.2.1:3478   |                       |
    | map  192.0.2.1:3478   |                       |
    |======================&gt;|                       |
    |                       | STUN Binding Response |
    |                       | from 192.0.2.3:45664  |
    |                       | to   192.0.2.1:3478   |
    |                       | map  192.0.2.1:3478   |
    |                       |======================&gt;|
    |                       |                       |
    |                       |==Media Now Can Flow==&gt;|
    |                       |                       |
    </PRE></DIV>
<P>Note: Here the initiator (controlling agent) is using "aggressive nomination" 
as described in Section 8.1.1.2 of <SPAN class=ref>ICE-CORE</SPAN> and therefore 
includes the USE-CANDIDATE attribute in the STUN Binding Requests it 
sends.</P></DIV>
<DIV class=indent>
<H3>5.7 <A id=protocol-acceptance name=protocol-acceptance>Acceptance of 
Successful Candidate</A></H3>
<P>If, based on STUN connectivity checks, the parties determine that they will 
be able to exchange media between a given pair of local candidates and remote 
candidates (i.e., the pair is "nominated" and ICE processing is "completed"), 
they can then begin using that candidate pair to exchange media.</P>
<P>Once the parties have connectivity and therefore the initiator has completed 
ICE as explained in <SPAN class=ref>ICE-CORE</SPAN>, the initiator MAY 
communicate the in-use candidate pair in the signalling channel by sending a 
transport-info message that contains a &lt;remote-candidate/&gt; element (this 
maps to the SDP "remote-candidates" attribute as described in Section B.6 of 
<SPAN class=ref>ICE-CORE</SPAN>, i.e., remote candidates are "the actual 
candidates at R that were selected by the offerer", of which there will be only 
one at this stage of the ICE-UDP negotiation).</P>
<P class=caption><A id=example-4 name=example-4></A>Example 4. Initiator 
communicates in-use candidate</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='romeo@montague.lit/orchard'
    id='pd81b49s'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
 &lt;jingle xmlns='urn:xmpp:jingle:1'
         action='transport-info'
         initiator='romeo@montague.lit/orchard'
         sid='a73sjjvkla37jfea'&gt;
   &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
     &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:1'
                pwd='asd88fgpdd777uzjYhagZg'
                ufrag='8hhy'&gt;
       &lt;remote-candidate component='1'
                         ip='10.0.1.2'
                         port='9001'/&gt;
     &lt;/transport&gt;
   &lt;/content&gt;
 &lt;/jingle&gt;
&lt;/iq&gt;
    </PRE></DIV>
<P>(In accordance with Jingle core, the responder will also acknowledge the 
transport-info message.)</P>
<P>In the unlikely event that one of the parties determines that it cannot 
establish connectivity even after sending and checking lower-priority 
candidates, it SHOULD terminate the session as described in <SPAN 
class=ref>XEP-0166</SPAN>.</P></DIV>
<DIV class=indent>
<H3>5.8 <A id=protocol-renegotiate name=protocol-renegotiate>Negotiating a New 
Candidate</A></H3>
<P>Even after media has begun to flow, either party MAY continue to send 
additional candidates to the other party (e.g., because the user agent has 
become aware of a new media proxy or network interface card). Such candidates 
are shared by sending a transport-info message.</P>
<P class=caption><A id=example-5 name=example-5></A>Example 5. Initiator sends a 
subsequent candidate</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='romeo@montague.lit/orchard'
    id='uh3g1f48'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='transport-info'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:1'
                 pwd='asd88fgpdd777uzjYhagZg'
                 ufrag='8hhy'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0'
                   id='m3110wc4nd'
                   ip='2001:db8::9:1'
                   network='0'
                   port='9001'
                   priority='21149780477'
                   protocol='udp'
                   type='host'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </PRE></DIV>
<P>The receiving party MUST acknowledge receipt of the candidate.</P>
<P class=caption><A id=example-6 name=example-6></A>Example 6. Recipient 
acknowledges receipt</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='juliet@capulet.lit/balcony'
    id='uh3g1f48'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
    </PRE></DIV>
<P>The parties would check the newly-offered candidate for connectivity, as 
described previously. If the parties determine that media can flow over the 
candidate, they MAY then use the new candidate in subsequent 
communications.</P></DIV>
<DIV class=indent>
<H3>5.9 <A id=protocol-restarts name=protocol-restarts>ICE Restarts</A></H3>
<P>At any time, either party MAY restart the process of ICE negotiation by 
sending a candidate with a 'generation' value that is greater than the previous 
generation of candidates; when it does so, it MUST generate new values for the 
'pwd' and 'ufrag' attributes, consistent with the definition of an ICE restart 
in Section 9.1.1.1 of <SPAN class=ref>ICE-CORE</SPAN>. As explained in <SPAN 
class=ref>ICE-CORE</SPAN>, typically the ICE negotiation would be restarted to 
change the media target (e.g., an IP address change for one of the parties) and 
certain third-party-call-control scenarios.</P>
<P class=caption><A id=example-7 name=example-7></A>Example 7. Initiator 
restarts ICE negotiation</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='romeo@montague.lit/orchard'
    id='kl23fs71'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='transport-info'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='this-is-the-audio-content'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:1'
                 pwd='bv71hdn38hgb39hf6xlk33'
                 ufrag='g7qs'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='1'
                   id='y3s2b30v3r'
                   ip='192.0.2.3'
                   network='1'
                   port='45665'
                   priority='1694498815'
                   protocol='udp'
                   type='srflx'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </PRE></DIV>
<P>The recipient then acknowledges receipt.</P>
<P class=caption><A id=example-8 name=example-8></A>Example 8. Recipient 
acknowledges transport-info</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='juliet@capulet.lit/balcony'
    id='kl23fs71'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
    </PRE></DIV>
<P>The parties would then exchange new candidates to renegotiate connectivity 
and would check the new candidates for connectivity, as described previously. If 
the parties determine that media can flow over one of the new candidates, they 
can then use the successful candidate in subsequent communications. However, 
while ICE is being renegotiated the parties can continue to send media with the 
existing candidate-in-use.</P></DIV>
<H2>6. <A id=fallback name=fallback>Fallback to Raw UDP</A></H2>
<P>It can happen that the responder does not support ICE, in which case it can 
be necessary to fall back to use of the <SPAN class=ref><A 
href="http://xmpp.org/extensions/xep-0177.html">Jingle Raw UDP Transport Method 
</A></SPAN>[<A 
href="http://xmpp.org/extensions/xep-0176.html#nt-id121025">13</A>]. One typical 
scenario is communication between an ICE-aware Jingle endpoint and a 
non-ICE-aware SIP endpoint through a Jingle-to-SIP gateway, as follows:</P>
<OL>
  <LI>The Jingle endpoint sends a session-initiate request to the SIP endpoint, 
  specifying a transport method of ICE-UDP.</LI>
  <LI>Based on capabilities information, the gateway knows that the SIP endpoint 
  does not support ICE, so it enables the endpoints to use its media relay. It 
  does this by: 
  <UL>
    <LI>Sending a transport-replace message to the Jingle endpoint on behalf of 
    the SIP endpoint, specifying a transport method of Raw UDP and a candidate 
    whose IP address and port are hosted at the gateway.</LI>
    <LI>Sending SIP INVITE to the SIP endpoint on behalf of the Jingle endpoint, 
    speciying an IP address and port at the gateway.</LI></UL></LI></OL>
<P>The session flow is as follows.</P>
<P class=caption></P>
<DIV class=indent><PRE class=prettyprint>Romeo                    Gateway                    Juliet
  |                         |                         |
  |   session-initiate      |                         |
  |   (audio definition)    |                         |
  |------------------------&gt;|                         |
  |   ack                   |                         |
  |&lt;------------------------|                         |
  |   transport-replace     |                         |
  |   (Raw UDP)             |                         |
  |&lt;------------------------|                         |
  |   ack                   |                         |
  |------------------------&gt;|                         |
  |   transport-accept      |                         |
  |------------------------&gt;|                         |
  |   ack                   |                         |
  |&lt;------------------------|   SIP INVITE            |
  |                         |------------------------&gt;|
  |                         |   200 OK                |
  |                         |&lt;------------------------|
  |   session-accept        |                         |
  |&lt;------------------------|                         |
  |   ack                   |                         |
  |------------------------&gt;|                         |
  |                    MEDIA SESSION                  |
  |&lt;=================================================&gt;|
  |                         |   session-terminate     |
  |                         |&lt;------------------------|
  |   session-terminate     |                         |
  |&lt;------------------------|                         |
  |   ack                   |                         |
  |------------------------&gt;|   ack                   |
  |                         |------------------------&gt;|
  |                         |                         |
    </PRE></DIV>
<P>The protocol flow is as follows, showing only the stanzas sent between Romeo 
and the gateway (acting on Juliet's behalf).</P>
<P class=caption><A id=example-9 name=example-9></A>Example 9. Initiator sends 
session-initiate</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='romeo@montague.lit/orchard'
    id='p01hf63x'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='session-initiate'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='voice'&gt;
      &lt;description xmlns='urn:xmpp:jingle:apps:rtp:1' media='audio'&gt;
        &lt;payload-type id='96' name='speex' clockrate='16000'/&gt;
        &lt;payload-type id='97' name='speex' clockrate='8000'/&gt;
        &lt;payload-type id='18' name='G729'/&gt;
        &lt;payload-type id='103' name='L16' clockrate='16000' channels='2'/&gt;
        &lt;payload-type id='98' name='x-ISAC' clockrate='8000'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:ice-udp:1'
                 pwd='asd88fgpdd777uzjYhagZg'
                 ufrag='8hhy'&gt;
        &lt;candidate component='1'
                   foundation='1'
                   generation='0'
                   id='el0747fg11'
                   ip='10.0.1.1'
                   network='1'
                   port='8998'
                   priority='2130706431'
                   protocol='udp'
                   type='host'/&gt;
        &lt;candidate component='1'
                   foundation='2'
                   generation='0'
                   id='y3s2b30v3r'
                   ip='192.0.2.3'
                   network='1'
                   port='45664'
                   priority='1694498815'
                   protocol='udp'
                   rel-addr='10.0.1.1'
                   rel-port='8998'
                   type='srflx'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </PRE></DIV>
<P class=caption><A id=example-10 name=example-10></A>Example 10. Responder 
acknowledges session-initiate</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='juliet@capulet.lit/balcony'
    id='p01hf63x'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
    </PRE></DIV>
<P>Immediately the gateway sends a transport-replace message to Romeo, 
specifying a transport of Raw UDP with a candidate whose IP address and port 
identify a media relay at the gateway.</P>
<P class=caption><A id=example-11 name=example-11></A>Example 11. Gateway sends 
transport-replace on behalf of responder</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='juliet@capulet.lit/balcony'
    id='hy2gd714'
    to='romeo@montague.lit/orchard'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='transport-replace'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='voice1'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:raw-udp:1'&gt;
        &lt;candidate generation='0'
                   id='a9j3mnbtu1'
                   ip='10.1.1.104'
                   port='13540'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </PRE></DIV>
<P>Romeo then acknowledges the transport-replace message and immediately also 
sends a transport-accept.</P>
<P class=caption><A id=example-12 name=example-12></A>Example 12. Initiator 
acknowledges transport-replace</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='romeo@montague.lit/orchard'
    id='hy2gd714'
    to='juliet@capulet.lit/balcony'
    type='result'/&gt;
    </PRE></DIV>
<P class=caption><A id=example-13 name=example-13></A>Example 13. Initiator 
accepts new transport</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='romeo@montague.lit/orchard'
    id='rb391gs5'
    to='juliet@capulet.lit/balcony'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='transport-accept'
          initiator='romeo@montague.lit/orchard'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='responder' name='voice2'&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:raw-udp:1'&gt;
        &lt;candidate generation='0'
                   id='a9j3mnbtu1'
                   ip='10.1.1.104'
                   port='13540'/&gt;
      &lt;/transport&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </PRE></DIV>
<P>The gateway then acknowledges the acceptance on behalf of Juliet.</P>
<P class=caption><A id=example-14 name=example-14></A>Example 14. Gateway 
acknowledges transport-accept</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='juliet@capulet.lit/balcony'
    id='rb391gs5'
    to='romeo@montague.lit/orchard'
    type='result'/&gt;
    </PRE></DIV>
<P>The responder then sends a session-accept through the gateway.</P>
<P class=caption><A id=example-15 name=example-15></A>Example 15. Responder 
sends session-accept</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='juliet@capulet.lit/balcony'
    id='ijf61d43'
    to='romeo@montague.lit/orchard'
    type='set'&gt;
  &lt;jingle xmlns='urn:xmpp:jingle:1'
          action='session-accept'
          initiator='romeo@montague.lit/orchard'
          responder='juliet@capulet.lit/balcony'
          sid='a73sjjvkla37jfea'&gt;
    &lt;content creator='initiator' name='voice'&gt;
      &lt;description xmlns='urn:xmpp:jingle:apps:rtp:1' media='audio'&gt;
        &lt;payload-type id='18' name='G729'/&gt;
      &lt;/description&gt;
      &lt;transport xmlns='urn:xmpp:jingle:transports:raw-udp:1'/&gt;
    &lt;/content&gt;
  &lt;/jingle&gt;
&lt;/iq&gt;
    </PRE></DIV>
<P class=caption><A id=example-16 name=example-16></A>Example 16. Initiator 
acknowledges session-accept</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='romeo@montague.lit/orchard'
    id='ijf61d43'
    to='juliet@capulet.lit/balcony'
    type='result'/&gt;
    </PRE></DIV>
<P>The endpoints now begin to exchange session media, and can continue the 
session as long as desired.</P>
<H2>7. <A id=support name=support>Determining Support</A></H2>
<DIV class=indent>
<H3>7.1 <A id=support-ice name=support-ice>ICE Support</A></H3>
<P>To advertise its support for the Jingle ICE-UDP Transport Method, when 
replying to <SPAN class=ref><A 
href="http://xmpp.org/extensions/xep-0030.html">Service Discovery</A></SPAN> [<A 
href="http://xmpp.org/extensions/xep-0176.html#nt-id121212">14</A>] information 
requests an entity MUST return URNs for any version of this protocol that the 
entity supports -- e.g., "urn:xmpp:jingle:transports:ice-udp:1" for this version 
and "urn:xmpp:jingle:transports:ice-udp:0" for the previous version (see <A 
href="http://xmpp.org/extensions/xep-0176.html#registrar-versioning">Namespace 
Versioning</A> regarding the possibility of incrementing the version 
number).</P>
<P class=caption><A id=example-17 name=example-17></A>Example 17. Service 
discovery information request</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='romeo@montague.lit/orchard'
    id='cv5x41g9'
    to='juliet@capulet.lit/balcony'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
  </PRE></DIV>
<P class=caption><A id=example-18 name=example-18></A>Example 18. Service 
discovery information response</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='juliet@capulet.lit/balcony'
    id='cv5x41g9'
    to='romeo@montague.lit/orchard'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;feature var='urn:xmpp:jingle:1'/&gt;
    &lt;feature var='urn:xmpp:jingle:transports:ice-udp:0'/&gt;
    &lt;feature var='urn:xmpp:jingle:transports:ice-udp:1'/&gt;
    &lt;feature var='urn:xmpp:jingle:apps:rtp:1'/&gt;
    &lt;feature var='urn:xmpp:jingle:apps:rtp:audio'/&gt;
    &lt;feature var='urn:xmpp:jingle:apps:rtp:video'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </PRE></DIV>
<P>In order for an application to determine whether an entity supports this 
protocol, where possible it SHOULD use the dynamic, presence-based profile of 
service discovery defined in <SPAN class=ref><A 
href="http://xmpp.org/extensions/xep-0115.html">Entity Capabilities</A></SPAN> 
[<A href="http://xmpp.org/extensions/xep-0176.html#nt-id121265">15</A>]. 
However, if an application has not received entity capabilities information from 
an entity, it SHOULD use explicit service discovery instead.</P></DIV>
<DIV class=indent>
<H3>7.2 <A id=support-sdp name=support-sdp>SDP Offer / Answer Support</A></H3>
<P>If an entity supports the SDP offer / answer model described in <SPAN 
class=ref>RFC 3264</SPAN> and therefore prefers to receive multiple candidates 
in a single transport-info message, it MUST advertise support for the 
"urn:ietf:rfc:3264" service discovery feature. Typically this feature will be 
advertised only by gateways between Jingle and SIP.</P>
<P class=caption><A id=example-19 name=example-19></A>Example 19. Service 
discovery information request</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='romeo@montague.lit/orchard'
    id='ce81f5d6'
    to='sip.shakespeare.lit'
    type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'/&gt;
&lt;/iq&gt;
  </PRE></DIV>
<P class=caption><A id=example-20 name=example-20></A>Example 20. Service 
discovery information response</P>
<DIV class=indent><PRE class=prettyprint>&lt;iq from='sip.shakespeare.lit'
    id='ce81f5d6'
    to='romeo@montague.lit/orchard'
    type='result'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#info'&gt;
    &lt;feature var='urn:ietf:rfc:3264'/&gt;
    &lt;feature var='urn:xmpp:jingle:1'/&gt;
    &lt;feature var='urn:xmpp:jingle:transports:ice-udp:0'/&gt;
    &lt;feature var='urn:xmpp:jingle:transports:ice-udp:1'/&gt;
    &lt;feature var='urn:xmpp:jingle:apps:rtp:1'/&gt;
    &lt;feature var='urn:xmpp:jingle:apps:rtp:audio'/&gt;
    &lt;feature var='urn:xmpp:jingle:apps:rtp:video'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
    </PRE></DIV></DIV>
<H2>8. <A id=impl name=impl>Implementation Notes</A></H2>
<P>In order to speed the negotiation process so that media can flow as quickly 
as possible, the initiator SHOULD gather and prioritize candidates in advance, 
or as soon as the principal begins the process of initiating a session.</P>
<H2>9. <A id=deploy name=deploy>Deployment Notes</A></H2>
<P>This specification applies exclusively to Jingle clients and places no 
additional requirements on XMPP servers. However, service administrators might 
wish to deploy a STUN server in order to ease the client-to-client negotiation 
process and a TURN server for media relaying (see <SPAN class=ref><A 
href="http://tools.ietf.org/html/draft-ietf-behave-turn">TURN</A></SPAN> [<A 
href="http://xmpp.org/extensions/xep-0176.html#nt-id121343">16</A>]). Deployment 
of support for <SPAN class=ref><A 
href="http://xmpp.org/extensions/xep-0215.html">External Service 
Discovery</A></SPAN> [<A 
href="http://xmpp.org/extensions/xep-0176.html#nt-id121368">17</A>] might also 
be helpful.</P>
<H2>10. <A id=security name=security>Security Considerations</A></H2>
<DIV class=indent>
<H3>10.1 <A id=security-sharing name=security-sharing>Sharing IP 
Addresses</A></H3>
<P>By definition, the exchange of transport candidates results in exposure of 
the sender's IP addresses, which comprise a form of personally identifying 
information. A Jingle client MUST enable a user to control which entities will 
be allowed to receive such information. If a human user explicitly accepts a 
session request, then the client SHOULD consider that action to imply approval 
of IP address sharing. However, waiting for a human user to explicitly accept 
the session request can result in delays during session setup, since it is more 
efficient to immediately begin sharing transport candidates. Therefore, it is 
RECOMMENDED for the client to immediately send transport candidates to a contact 
(without waiting for explicit user approval of the session request) in the 
following cases:</P>
<OL>
  <LI>The user has permanently and formally authorized the contact to view the 
  user's presence information via a presence subscription as reflected in an 
  XMPP roster item (see <SPAN class=ref><A 
  href="http://tools.ietf.org/html/rfc3921">XMPP IM</A></SPAN> [<A 
  href="http://xmpp.org/extensions/xep-0176.html#nt-id121422">18</A>]).</LI>
  <LI>The user has temporarily and dynamically shared presence with the contact 
  via "directed presence" as described in <SPAN class=ref>RFC 3921</SPAN>.</LI>
  <LI>The user has explicitly added the contact to a "whitelist" of entities who 
  are allowed to access the user's personally-identifying 
information.</LI></OL></DIV>
<DIV class=indent>
<H3>10.2 <A id=security-media name=security-media>Encryption of Media</A></H3>
<P>A Jingle implementation SHOULD support security preconditions that are 
enforced before application media is allowed to flow over a UDP association, 
such as those described in <SPAN class=ref><A 
href="http://tools.ietf.org/html/draft-meyer-xmpp-e2e-encryption">Jingle 
XTLS</A></SPAN> [<A 
href="http://xmpp.org/extensions/xep-0176.html#nt-id121467">19</A>].</P>
<P>Application types that use the Jingle ICE-UDP transport method MAY also 
define their own application-specific encryption methods, such as the Secure 
Real-time Transport Protocol (SRTP) for RTP exchanges as described in <SPAN 
class=ref><A href="http://xmpp.org/extensions/xep-0167.html">Jingle RTP 
Sessions</A></SPAN> [<A 
href="http://xmpp.org/extensions/xep-0176.html#nt-id121497">20</A>].</P></DIV>
<H2>11. <A id=iana name=iana>IANA Considerations</A></H2>
<P>This document requires no interaction with the <SPAN class=ref><A 
href="http://www.iana.org/">Internet Assigned Numbers Authority 
(IANA)</A></SPAN> [<A 
href="http://xmpp.org/extensions/xep-0176.html#nt-id121528">21</A>].</P>
<H2>12. <A id=registrar name=registrar>XMPP Registrar Considerations</A></H2>
<DIV class=indent>
<H3>12.1 <A id=registrar-ns name=registrar-ns>Protocol Namespaces</A></H3>
<P>This specification defines the following XML namespace:</P>
<UL>
  <LI>urn:xmpp:jingle:transports:ice-udp:1</LI></UL>
<P>The <SPAN class=ref><A href="http://xmpp.org/registrar/">XMPP 
Registrar</A></SPAN> [<A 
href="http://xmpp.org/extensions/xep-0176.html#nt-id121603">22</A>] includes the 
foregoing namespace in its registry at &lt;<A 
href="http://xmpp.org/registrar/namespaces.html">http://xmpp.org/registrar/namespaces.html</A>&gt;, 
as governed by <SPAN class=ref><A 
href="http://xmpp.org/extensions/xep-0053.html">XMPP Registrar 
Function</A></SPAN> [<A 
href="http://xmpp.org/extensions/xep-0176.html#nt-id121612">23</A>].</P></DIV>
<DIV class=indent>
<H3>12.2 <A id=registrar-versioning name=registrar-versioning>Protocol 
Versioning</A></H3>
<P>If the protocol defined in this specification undergoes a revision that is 
not fully backwards-compatible with an older version, the XMPP Registrar shall 
increment the protocol version number found at the end of the XML namespaces 
defined herein, as described in Section 4 of <SPAN 
class=ref>XEP-0053</SPAN>.</P></DIV>
<DIV class=indent>
<H3>12.3 <A id=registrar-features name=registrar-features>Service Discovery 
Features</A></H3>
<P>If an entity supports the SDP offer / answer model described in <SPAN 
class=ref>RFC 3264</SPAN> and therefore prefers to receive one transport-info 
message with multiple candidates, it MUST advertise support for the 
"urn:ietf:rfc:3264" feature.</P>
<P>The registry submission is as follows.</P>
<P class=caption>Registry Submission</P>
<DIV class=indent><PRE class=prettyprint>&lt;var&gt;
  &lt;name&gt;urn:ietf:rfc:3264&lt;/name&gt;
  &lt;desc&gt;
    Signals support for the SDP offer / answer model 
    described in RFC 3264
  &lt;/desc&gt;
  &lt;doc&gt;XEP-0176&lt;/doc&gt;
&lt;/var&gt;
    </PRE></DIV></DIV>
<DIV class=indent>
<H3>12.4 <A id=registrar-transports name=registrar-transports>Jingle Transport 
Methods</A></H3>
<P>The XMPP Registrar includes "ice-udp" in its registry of Jingle transport 
methods at &lt;<A 
href="http://xmpp.org/registrar/jingle-transports.html">http://xmpp.org/registrar/jingle-transports.html</A>&gt;. 
The registry submission is as follows:</P>
<P class=caption></P>
<DIV class=indent><PRE class=prettyprint>&lt;transport&gt;
  &lt;name&gt;ice-udp&lt;/name&gt;
  &lt;desc&gt;
    A method for negotiation of out-of-band UDP connections 
    with built-in NAT and firewall traversal, equivalent to 
    the IETF's Interactive Connectivity Establishment (ICE) 
    methodology when resulting in the use of UDP as the
    transport protocol.
  &lt;/desc&gt;
  &lt;type&gt;datagram&lt;/type&gt;
  &lt;doc&gt;XEP-0176&lt;/doc&gt;
&lt;/transport&gt;
    </PRE></DIV></DIV>
<H2>13. <A id=schema name=schema>XML Schema</A></H2>
<P class=caption></P>
<DIV class=indent><PRE class=prettyprint>&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='urn:xmpp:jingle:transports:ice-udp:1'
    xmlns='urn:xmpp:jingle:transports:ice-udp:1'
    elementFormDefault='qualified'&gt;

  &lt;xs:annotation&gt;
    &lt;xs:documentation&gt;
      The protocol documented by this schema is defined in
      XEP-0176: http://www.xmpp.org/extensions/xep-0176.html
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name='transport'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:choice minOccurs='0'&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name='candidate' 
                      type='candidateElementType'
                      minOccurs='1' 
                      maxOccurs='unbounded'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name='remote-candidate' 
                      type='remoteCandidateElementType'
                      minOccurs='1' 
                      maxOccurs='1'/&gt;
        &lt;/xs:sequence&gt;
      &lt;/xs:choice&gt;
      &lt;xs:attribute name='pwd' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='ufrag' type='xs:string' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:complexType name='candidateElementType'&gt;
    &lt;xs:simpleContent&gt;
      &lt;xs:extension base='empty'&gt;
        &lt;xs:attribute name='component' type='xs:unsignedByte' use='required'/&gt;
        &lt;xs:attribute name='foundation' type='xs:unsignedByte' use='required'/&gt;
        &lt;xs:attribute name='generation' type='xs:unsignedByte' use='required'/&gt;
        &lt;xs:attribute name='id' type='xs:NCName' use='required'/&gt;
        &lt;xs:attribute name='ip' type='xs:string' use='required'/&gt;
        &lt;xs:attribute name='network' type='xs:unsignedByte' use='required'/&gt;
        &lt;xs:attribute name='port' type='xs:unsignedShort' use='required'/&gt;
        &lt;xs:attribute name='priority' type='xs:positiveInteger' use='required'/&gt;
        &lt;xs:attribute name='protocol' type='xs:NCName' use='required'/&gt;
        &lt;xs:attribute name='rel-addr' type='xs:string' use='optional'/&gt;
        &lt;xs:attribute name='rel-port' type='xs:unsignedShort' use='optional'/&gt;
        &lt;xs:attribute name='type' use='required'&gt;
          &lt;xs:simpleType&gt;
            &lt;xs:restriction base='xs:NCName'&gt;
              &lt;xs:enumeration value='host'/&gt;
              &lt;xs:enumeration value='prflx'/&gt;
              &lt;xs:enumeration value='relay'/&gt;
              &lt;xs:enumeration value='srflx'/&gt;
            &lt;/xs:restriction&gt;
          &lt;/xs:simpleType&gt;
        &lt;/xs:attribute&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:simpleContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:complexType name='remoteCandidateElementType'&gt;
    &lt;xs:simpleContent&gt;
      &lt;xs:extension base='empty'&gt;
        &lt;xs:attribute name='component' type='xs:unsignedByte' use='required'/&gt;
        &lt;xs:attribute name='ip' type='xs:string' use='required'/&gt;
        &lt;xs:attribute name='port' type='xs:unsignedShort' use='required'/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:simpleContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:simpleType name='empty'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:enumeration value=''/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

&lt;/xs:schema&gt;
  </PRE></DIV>
<H2>14. <A id=ack name=ack>Acknowledgements</A></H2>
<P>Thanks to Diana Cionoiu, Olivier Crête, Tim Julien, Steffen Larsen, Robert 
McQueen, Mike Ruprecht, Justin Uberti, Unnikrishnan Vikrama Panicker, and Paul 
Witty for their feedback.</P>
<HR>
<A id=appendices name=appendices></A>
<H2>Appendices</H2>
<HR>
<A id=appendix-docinfo name=appendix-docinfo></A>
<H3>Appendix A: Document Information</H3>
<P class=indent>Series: <A href="http://xmpp.org/extensions/">XEP</A><BR>Number: 
0176<BR>Publisher: <A href="http://xmpp.org/xsf/">XMPP Standards 
Foundation</A><BR>Status: <A 
href="http://xmpp.org/extensions/xep-0001.html#states-Draft">Draft</A><BR>Type: 
<A 
href="http://xmpp.org/extensions/xep-0001.html#types-Standards Track">Standards 
Track</A><BR>Version: 1.0<BR>Last Updated: 2009-06-10<BR>Approving Body: <A 
href="http://xmpp.org/council/">XMPP Council</A><BR>Dependencies: XMPP Core, 
XEP-0166<BR>Supersedes: None<BR>Superseded By: None<BR>Short Name: 
jingle-ice-udp<BR>XML Schema for jingle:transports:ice-udp namespace: &lt;<A 
href="http://xmpp.org/schemas/jingle-transports-ice-udp.xsd">http://xmpp.org/schemas/jingle-transports-ice-udp.xsd</A>&gt;<BR>Source 
Control: <A class=standardsButton 
href="http://svn.xmpp.org:18080/browse/XMPP/trunk/extensions/xep-0176.xml">HTML</A>&nbsp; 
<A class=standardsButton 
href="http://svn.xmpp.org:18080//changelog/~rss/XMPP/trunk/extensions/xep-0176.xml/rss.xml">RSS</A><BR>This 
document in other formats: <A class=standardsButton 
href="http://xmpp.org/extensions/xep-0176.xml">XML</A>&nbsp; <A 
class=standardsButton href="http://xmpp.org/extensions/xep-0176.pdf">PDF</A></P>
<HR>
<A id=appendix-authorinfo name=appendix-authorinfo></A>
<H3>Appendix B: Author Information</H3>
<DIV class=indent>
<H3>Joe Beda</H3>
<P class=indent>Email: <A 
href="mailto:jbeda@google.com">jbeda@google.com</A><BR>JabberID: <A 
href="xmpp:jbeda@google.com">xmpp:jbeda@google.com</A><BR></P>
<H3>Scott Ludwig</H3>
<P class=indent>Email: <A 
href="mailto:scottlu@google.com">scottlu@google.com</A><BR>JabberID: <A 
href="xmpp:scottlu@google.com">xmpp:scottlu@google.com</A><BR></P>
<H3>Peter Saint-Andre</H3>
<P class=indent>Email: <A 
href="mailto:stpeter@jabber.org">stpeter@jabber.org</A><BR>JabberID: <A 
href="xmpp:stpeter@jabber.org">xmpp:stpeter@jabber.org</A><BR>URI: <A 
href="https://stpeter.im/">https://stpeter.im/</A><BR></P>
<H3>Joe Hildebrand</H3>
<P class=indent>Email: <A 
href="mailto:jhildebr@cisco.com">jhildebr@cisco.com</A><BR>JabberID: <A 
href="xmpp:hildjj@jabber.org">xmpp:hildjj@jabber.org</A><BR></P>
<H3>Sean Egan</H3>
<P class=indent>Email: <A 
href="mailto:seanegan@google.com">seanegan@google.com</A><BR>JabberID: <A 
href="xmpp:seanegan@google.com">xmpp:seanegan@google.com</A><BR></P>
<H3>Robert McQueen</H3>
<P class=indent>Email: <A 
href="mailto:robert.mcqueen@collabora.co.uk">robert.mcqueen@collabora.co.uk</A><BR>JabberID: 
<A 
href="xmpp:robert.mcqueen@collabora.co.uk">xmpp:robert.mcqueen@collabora.co.uk</A><BR></P></DIV>
<HR>
<A id=appendix-legal name=appendix-legal></A>
<H3>Appendix C: Legal Notices</H3>
<DIV class=indent>
<H4>Copyright</H4>This XMPP Extension Protocol is copyright © 1999 - 2010 by the 
<A href="http://xmpp.org/">XMPP Standards Foundation</A> (XSF).
<H4>Permissions</H4>Permission is hereby granted, free of charge, to any person 
obtaining a copy of this specification (the "Specification"), to make use of the 
Specification without restriction, including without limitation the rights to 
implement the Specification in a software program, deploy the Specification in a 
network service, and copy, modify, merge, publish, translate, distribute, 
sublicense, or sell copies of the Specification, and to permit persons to whom 
the Specification is furnished to do so, subject to the condition that the 
foregoing copyright notice and this permission notice shall be included in all 
copies or substantial portions of the Specification. Unless separate permission 
is granted, modified works that are redistributed shall not contain misleading 
information regarding the authors, title, number, or publisher of the 
Specification, and shall not claim endorsement of the modified works by the 
authors, any organization or project to which the authors belong, or the XMPP 
Standards Foundation.
<H4>Disclaimer of Warranty</H4><SPAN style="FONT-WEIGHT: bold">## NOTE WELL: 
This Specification is provided on an "AS IS" BASIS, WITHOUT WARRANTIES OR 
CONDITIONS OF ANY KIND, express or implied, including, without limitation, any 
warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS 
FOR A PARTICULAR PURPOSE. ##</SPAN>
<H4>Limitation of Liability</H4>In no event and under no legal theory, whether 
in tort (including negligence), contract, or otherwise, unless required by 
applicable law (such as deliberate and grossly negligent acts) or agreed to in 
writing, shall the XMPP Standards Foundation or any author of this Specification 
be liable for damages, including any direct, indirect, special, incidental, or 
consequential damages of any character arising from, out of, or in connection 
with the Specification or the implementation, deployment, or other use of the 
Specification (including but not limited to damages for loss of goodwill, work 
stoppage, computer failure or malfunction, or any and all other commercial 
damages or losses), even if the XMPP Standards Foundation or such author has 
been advised of the possibility of such damages.
<H4>IPR Conformance</H4>This XMPP Extension Protocol has been contributed in 
full conformance with the XSF's Intellectual Property Rights Policy (a copy of 
which can be found at &lt;<A 
href="http://xmpp.org/extensions/ipr-policy.shtml">http://xmpp.org/extensions/ipr-policy.shtml</A>&gt; 
or obtained by writing to XMPP Standards Foundation, 1899 Wynkoop Street, Suite 
600, Denver, CO 80202 USA).</DIV>
<HR>
<A id=appendix-xmpp name=appendix-xmpp></A>
<H3>Appendix D: Relation to XMPP</H3>
<P class=indent>The Extensible Messaging and Presence Protocol (XMPP) is defined 
in the XMPP Core (RFC 3920) and XMPP IM (RFC 3921) specifications contributed by 
the XMPP Standards Foundation to the Internet Standards Process, which is 
managed by the Internet Engineering Task Force in accordance with RFC 2026. Any 
protocol defined in this document has been developed outside the Internet 
Standards Process and is to be understood as an extension to XMPP rather than as 
an evolution, development, or modification of XMPP itself.</P>
<HR>
<A id=appendix-discuss name=appendix-discuss></A>
<H3>Appendix E: Discussion Venue</H3>
<P class=indent>There exists a special venue for discussion related to the 
technology described in this document: the &lt;<A 
href="http://mail.jabber.org/mailman/listinfo/jingle">http://mail.jabber.org/mailman/listinfo/jingle</A>&gt; 
mailing list.</P>
<P class=indent>The primary venue for discussion of XMPP Extension Protocols is 
the &lt;<A 
href="http://mail.jabber.org/mailman/listinfo/standards">http://mail.jabber.org/mailman/listinfo/standards</A>&gt; 
discussion list.</P>
<P class=indent>Discussion on other xmpp.org discussion lists might also be 
appropriate; see &lt;<A 
href="http://xmpp.org/about/discuss.shtml">http://xmpp.org/about/discuss.shtml</A>&gt; 
for a complete list.</P>
<P class=indent>Errata can be sent to &lt;<A 
href="mailto:editor@xmpp.org">editor@xmpp.org</A>&gt;.</P>
<HR>
<A id=appendix-conformance name=appendix-conformance></A>
<H3>Appendix F: Requirements Conformance</H3>
<P class=indent>The following requirements keywords as used in this document are 
to be interpreted as described in <A 
href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</A>: "MUST", "SHALL", 
"REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT 
RECOMMENDED"; "MAY", "OPTIONAL".</P>
<HR>
<A id=appendix-notes name=appendix-notes></A>
<H3>Appendix G: Notes</H3>
<DIV class=indent>
<P><A id=nt-id119797 name=nt-id119797>1</A>. XEP-0166: Jingle &lt;<A 
href="http://xmpp.org/extensions/xep-0166.html">http://xmpp.org/extensions/xep-0166.html</A>&gt;.</P>
<P><A id=nt-id119825 name=nt-id119825>2</A>. RFC 768: User Datagram Protocol 
&lt;<A 
href="http://tools.ietf.org/html/rfc0768">http://tools.ietf.org/html/rfc0768</A>&gt;.</P>
<P><A id=nt-id119848 name=nt-id119848>3</A>. Interactive Connectivity 
Establishment (ICE): A Methodology for Network Address Translator (NAT) 
Traversal for Offer/Answer Protocols &lt;<A 
href="http://tools.ietf.org/html/draft-ietf-mmusic-ice">http://tools.ietf.org/html/draft-ietf-mmusic-ice</A>&gt;. 
Work in progress.</P>
<P><A id=nt-id119889 name=nt-id119889>4</A>. RFC 4566: SDP: Session Description 
Protocol &lt;<A 
href="http://tools.ietf.org/html/rfc4566">http://tools.ietf.org/html/rfc4566</A>&gt;.</P>
<P><A id=nt-id119930 name=nt-id119930>5</A>. RFC 3264: An Offer/Answer Model 
with the Session Description Protocol (SDP) &lt;<A 
href="http://tools.ietf.org/html/rfc3264">http://tools.ietf.org/html/rfc3264</A>&gt;.</P>
<P><A id=nt-id120435 name=nt-id120435>6</A>. In accordance with the rules 
specified in Section 4.1.1 of <SPAN class=ref>ICE-CORE</SPAN>, the priority 
values shown in the examples within this document have been calculated as 
follows. The "type preference" for host candidates is stipulated to be "126" and 
for server reflexive candidates "100". The "local preference" for network 0 is 
stipulated to be "4096", for network 1 "2048", and for network 2 "1024".</P>
<P><A id=nt-id120460 name=nt-id120460>7</A>. Future specifications might define 
other values such as "tcp".</P>
<P><A id=nt-id120586 name=nt-id120586>8</A>. Given in-order delivery as mandated 
by <SPAN class=ref><A href="http://tools.ietf.org/html/rfc3920">XMPP 
Core</A></SPAN> [<A 
href="http://xmpp.org/extensions/xep-0176.html#nt-id120631">9</A>], the 
responder will receive such transport-info messages after receiving the 
session-initiate message; if not, it is appropriate for the responder to return 
&lt;unknown-session/&gt; errors since according to its state machine the session 
does not exist.</P>
<P><A id=nt-id120631 name=nt-id120631>9</A>. RFC 3920: Extensible Messaging and 
Presence Protocol (XMPP): Core &lt;<A 
href="http://tools.ietf.org/html/rfc3920">http://tools.ietf.org/html/rfc3920</A>&gt;.</P>
<P><A id=nt-id120619 name=nt-id120619>10</A>. The fact that both parties send 
candidates means that Jingle requires each party to be a full implementation of 
ICE, not a lite implementation as specified in <SPAN 
class=ref>ICE-CORE</SPAN>.</P>
<P><A id=nt-id120735 name=nt-id120735>11</A>. RFC 5389: Session Traversal 
Utilities for NAT (STUN) &lt;<A 
href="http://tools.ietf.org/html/rfc5389">http://tools.ietf.org/html/rfc5389</A>&gt;.</P>
<P><A id=nt-id120773 name=nt-id120773>12</A>. Thus when Romeo sends a STUN 
Binding Request to Juliet the credentials will be STUN username "9uB6:8hhy" 
(ufrag provided by Juliet concatenated with ufrag provided by Romeo) and 
password "YH75Fviy6338Vbrhrlp8Yh" (pwd provided by Juliet) whereas when Juliet 
sends a STUN Binding Request to Romeo the credentials will be STUN username 
"8hhy:9uB6" (ufrag provided by Romeo concatenated with ufrag provided by Juliet) 
and password "asd88fgpdd777uzjYhagZg" (pwd provided by Romeo).</P>
<P><A id=nt-id121025 name=nt-id121025>13</A>. XEP-0177: Jingle Raw UDP Transport 
Method &lt;<A 
href="http://xmpp.org/extensions/xep-0177.html">http://xmpp.org/extensions/xep-0177.html</A>&gt;.</P>
<P><A id=nt-id121212 name=nt-id121212>14</A>. XEP-0030: Service Discovery &lt;<A 
href="http://xmpp.org/extensions/xep-0030.html">http://xmpp.org/extensions/xep-0030.html</A>&gt;.</P>
<P><A id=nt-id121265 name=nt-id121265>15</A>. XEP-0115: Entity Capabilities 
&lt;<A 
href="http://xmpp.org/extensions/xep-0115.html">http://xmpp.org/extensions/xep-0115.html</A>&gt;.</P>
<P><A id=nt-id121343 name=nt-id121343>16</A>. Traversal Using Relays around NAT 
(TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN) &lt;<A 
href="http://tools.ietf.org/html/draft-ietf-behave-turn">http://tools.ietf.org/html/draft-ietf-behave-turn</A>&gt;. 
Work in progress.</P>
<P><A id=nt-id121368 name=nt-id121368>17</A>. XEP-0215: External Service 
Discovery &lt;<A 
href="http://xmpp.org/extensions/xep-0215.html">http://xmpp.org/extensions/xep-0215.html</A>&gt;.</P>
<P><A id=nt-id121422 name=nt-id121422>18</A>. RFC 3921: Extensible Messaging and 
Presence Protocol (XMPP): Instant Messaging and Presence &lt;<A 
href="http://tools.ietf.org/html/rfc3921">http://tools.ietf.org/html/rfc3921</A>&gt;.</P>
<P><A id=nt-id121467 name=nt-id121467>19</A>. Extensible Messaging and Presence 
Protocol (XMPP) End-to-End Encryption Using Transport Layer Security ("XTLS") 
&lt;<A 
href="http://tools.ietf.org/html/draft-meyer-xmpp-e2e-encryption">http://tools.ietf.org/html/draft-meyer-xmpp-e2e-encryption</A>&gt;.</P>
<P><A id=nt-id121497 name=nt-id121497>20</A>. XEP-0167: Jingle RTP Sessions 
&lt;<A 
href="http://xmpp.org/extensions/xep-0167.html">http://xmpp.org/extensions/xep-0167.html</A>&gt;.</P>
<P><A id=nt-id121528 name=nt-id121528>21</A>. The Internet Assigned Numbers 
Authority (IANA) is the central coordinator for the assignment of unique 
parameter values for Internet protocols, such as port numbers and URI schemes. 
For further information, see &lt;<A 
href="http://www.iana.org/">http://www.iana.org/</A>&gt;.</P>
<P><A id=nt-id121603 name=nt-id121603>22</A>. The XMPP Registrar maintains a 
list of reserved protocol namespaces as well as registries of parameters used in 
the context of XMPP extension protocols approved by the XMPP Standards 
Foundation. For further information, see &lt;<A 
href="http://xmpp.org/registrar/">http://xmpp.org/registrar/</A>&gt;.</P>
<P><A id=nt-id121612 name=nt-id121612>23</A>. XEP-0053: XMPP Registrar Function 
&lt;<A 
href="http://xmpp.org/extensions/xep-0053.html">http://xmpp.org/extensions/xep-0053.html</A>&gt;.</P></DIV>
<HR>
<A id=appendix-revs name=appendix-revs></A>
<H3>Appendix H: Revision History</H3>
<P>Note: Older versions of this specification might be available at <A 
href="http://xmpp.org/extensions/attic/">http://xmpp.org/extensions/attic/</A></P>
<DIV class=indent>
<H4>Version 1.0 (2009-06-10)</H4>
<DIV class=indent>
<P>Per a vote of the XMPP Council, advanced specification from Experimental to 
Draft.</P>(psa) </DIV>
<H4>Version 0.27 (2009-05-27)</H4>
<DIV class=indent>
<P>Clarified ICE restarts and use of the generation attribute, in accordance 
with the ICE specification.</P>(psa) </DIV>
<H4>Version 0.26 (2009-03-09)</H4>
<DIV class=indent>
<P>Minor changes to track modifications to XEP-0166.</P>(psa) </DIV>
<H4>Version 0.25 (2009-02-26)</H4>
<DIV class=indent>
<P>Specified that pwd and ufrag attributes must be included when sending the 
first candidate; removed rem-addr and rem-port attributes and instead defined 
transport-info payload for communication of the remote candidate.</P>(psa) 
</DIV>
<H4>Version 0.24 (2009-02-17)</H4>
<DIV class=indent>
<P>Simplified flow by including candidates in session-initiate and 
session-accept.</P>(psa/rm) </DIV>
<H4>Version 0.23 (2008-12-19)</H4>
<DIV class=indent>
<P>Specified id attribute and added it to the examples; updated namespaces to 
reflect changes to other Jingle specifications; completed editorial 
review.</P>(psa) </DIV>
<H4>Version 0.22 (2008-09-30)</H4>
<DIV class=indent>
<P>Corrected fallback scenario to use transport-replace and 
transport-accept.</P>(psa) </DIV>
<H4>Version 0.21 (2008-09-25)</H4>
<DIV class=indent>
<UL>
  <LI>Added section on fallback to Raw UDP transport method.</LI>
  <LI>Modified namespaces to incorporate namespace versioning.</LI>
  <LI>Cleaned up XML schemas.</LI></UL>(psa) </DIV>
<H4>Version 0.20 (2008-07-31)</H4>
<DIV class=indent>
<P>For consistency with XEP-0166, removed profile attribute, changed 
content-replace to transport-replace, and changed content-accept to 
transport-accept.</P>(psa) </DIV>
<H4>Version 0.19 (2008-06-04)</H4>
<DIV class=indent>
<P>Allowed batching of multiple candidates in a single transport-info message 
for optional interworking with the SDP offer-answer model, and added 
urn:ietf:rfc:3264 service discovery feature to advertise such support; updated 
security considerations regarding sharing of IP addresses.</P>(psa) </DIV>
<H4>Version 0.18 (2008-05-28)</H4>
<DIV class=indent>
<P>Removed content-replace message from acceptance flow, since in ICE that 
information is sent via STUN, not in the signalling channel.</P>(psa) </DIV>
<H4>Version 0.17 (2008-03-20)</H4>
<DIV class=indent>
<P>Moved pwd and ufrag attributes from candidate element to transport element 
since they describe session-level or media-level information.</P>(psa) </DIV>
<H4>Version 0.16 (2008-02-29)</H4>
<DIV class=indent>
<P>Changed content-modify to content-replace per XEP-0166.</P>(psa) </DIV>
<H4>Version 0.15 (2008-01-06)</H4>
<DIV class=indent>
<P>Clarified several small points regarding candidate gathering procedures and 
STUN connectivity checks.</P>(psa) </DIV>
<H4>Version 0.14 (2008-01-02)</H4>
<DIV class=indent>
<P>Modified flow for ICE completion to require content-modify from initiator to 
responder, thus mapping to sending of revised offer in SIP; added rem-addr and 
rem-port attributes to map to a=remote-candidates information in SDP; changed 
raddr and rport attributes to rel-addr and rel-port to prevent confusion with 
rem-addr and rem-port attributes.</P>(psa) </DIV>
<H4>Version 0.13 (2007-12-28)</H4>
<DIV class=indent>
<P>Added further details about connectivity checks; defined raddr and rport 
attributes for complete mapping to SDP.</P>(psa) </DIV>
<H4>Version 0.12 (2007-11-28)</H4>
<DIV class=indent>
<P>Moved ice-tcp definition to a separate specification.</P>(psa) </DIV>
<H4>Version 0.11 (2007-11-27)</H4>
<DIV class=indent>
<P>Further editorial review; also added sections on modification of existing 
candidates and exchange of subsequent candidates.</P>(psa) </DIV>
<H4>Version 0.10 (2007-11-15)</H4>
<DIV class=indent>
<P>Editorial review and consistency check.</P>(psa) </DIV>
<H4>Version 0.9 (2007-06-28)</H4>
<DIV class=indent>
<P>Updated to track ICE-16.</P>(psa) </DIV>
<H4>Version 0.8 (2007-04-17)</H4>
<DIV class=indent>
<P>Separately defined ice-tcp and ice-udp transport methods to enable clearer 
definition of transport methods and reuse by application types; specified Jingle 
conformance, including definition of ice-udp as datagram and ice-tcp as 
streaming.</P>(psa) </DIV>
<H4>Version 0.7 (2007-03-23)</H4>
<DIV class=indent>
<P>Updated to track ICE-14 and ICE-TCP-03; moved text on discovery of STUN 
servers to separate specification.</P>(psa) </DIV>
<H4>Version 0.6 (2006-12-21)</H4>
<DIV class=indent>
<P>Modified spec to use provisional namespace before advancement to Draft (per 
XEP-0053).</P>(psa) </DIV>
<H4>Version 0.5 (2006-10-31)</H4>
<DIV class=indent>
<P>Updated to track ICE-12; corrected service discovery process; completed 
editorial review; removed mention of DTMF, which is for audio only.</P>(psa) 
</DIV>
<H4>Version 0.4 (2006-09-13)</H4>
<DIV class=indent>
<P>Updated to track ICE-10; added section on service discovery.</P>(psa) </DIV>
<H4>Version 0.3 (2006-07-12)</H4>
<DIV class=indent>
<P>Specified that DTMF must use in-band signalling (XEP-0181).</P>(se/psa) 
</DIV>
<H4>Version 0.2 (2006-03-24)</H4>
<DIV class=indent>
<P>Recommended use of RTP-native methods for DTMF.</P>(psa) </DIV>
<H4>Version 0.1 (2006-03-01)</H4>
<DIV class=indent>
<P>Initial version (split from XEP-0166).</P>(psa/jb) </DIV></DIV>
<HR>

<P>END</P></BODY></HTML>
